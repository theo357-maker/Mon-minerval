<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Système Intégré de Gestion de Minerval</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary-color: #1a237e;
            --secondary-color: #ff9800;
            --danger-color: #d32f2f;
            --success-color: #388e3c;
            --light-color: #f5f5f5;
            --dark-color: #212121;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f0f2f5;
            color: var(--dark-color);
            min-height: 100vh;
        }

        /* Login Page Styles */
        .login-page {
            background: linear-gradient(135deg, var(--primary-color), #283593);
            color: white;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .login-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 500px;
            padding: 40px;
            color: #333;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo img {
            height: 80px;
            width: auto;
            margin-bottom: 15px;
        }

        .logo h1 {
            color: #1a237e;
            font-size: 24px;
        }

        .logo p {
            color: #666;
            font-size: 16px;
        }

        .login-title {
            text-align: center;
            margin-bottom: 30px;
            color: #1a237e;
            font-size: 22px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1a237e;
        }

        .form-group input {
            width: 100%;
            padding: 14px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-group input:focus {
            border-color: #1a237e;
            outline: none;
            box-shadow: 0 0 0 3px rgba(26, 35, 126, 0.2);
        }

        .btn-login {
            width: 100%;
            padding: 14px;
            background: #1a237e;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-login:hover {
            background: #000051;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .error-message {
            color: #d32f2f;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .forgot-password {
            text-align: right;
            margin-top: 10px;
        }

        .forgot-password a {
            color: #1a237e;
            text-decoration: none;
            font-size: 14px;
        }

        /* Main Application Styles */
        .main-app {
            display: none;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), #283593);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-container img {
            height: 50px;
            width: auto;
        }

        .logo-text h1 {
            font-size: 24px;
            font-weight: 700;
        }

        .logo-text p {
            font-size: 14px;
            opacity: 0.9;
        }

        .auth-section {
            display: flex;
            gap: 15px;
        }

        .nav-container {
            background: var(--primary-color);
            display: flex;
            justify-content: center;
            position: relative;
        }

        .nav-btn {
            padding: 18px 40px;
            background: transparent;
            border: none;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn.active {
            background: var(--secondary-color);
        }

        .nav-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-btn i {
            font-size: 18px;
        }

        .page {
            display: none;
            padding: 30px;
            min-height: 600px;
        }

        .page.active {
            display: block;
        }

        .form-container {
            display: flex;
            gap: 40px;
            flex-wrap: wrap;
        }

        .form-section {
            flex: 1;
            min-width: 300px;
        }

        .preview-section {
            flex: 1;
            min-width: 300px;
            border-left: 2px dashed var(--primary-color);
            padding-left: 40px;
        }

        .section-title {
            color: var(--primary-color);
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--secondary-color);
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: var(--secondary-color);
        }

        .form-row {
            display: flex;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .form-label {
            width: 200px;
            font-weight: 600;
            color: var(--primary-color);
            font-size: 15px;
        }

        .form-label.required::after {
            content: '*';
            color: var(--danger-color);
            margin-left: 5px;
        }

        .form-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 15px;
            transition: all 0.3s;
            min-width: 250px;
        }

        .form-input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(26, 35, 126, 0.2);
        }

        .form-input.error {
            border-color: var(--danger-color);
        }

        .tranche-container {
            margin-top: 10px;
        }

        .tranche-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .tranche-item {
            padding: 10px;
            text-align: center;
            background: #e8eaf6;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            transition: all 0.2s;
            font-weight: 500;
            display: flex;
            flex-direction: column;
        }
        
        .tranche-item:hover {
            background: #c5cae9;
            transform: translateY(-2px);
        }
        
        .tranche-item.selected {
            background: var(--primary-color);
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .btn-container {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-width: 200px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #000051;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background: #e65100;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #1b5e20;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: #b71c1c;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .code-section {
            background: #e8eaf6;
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .code-display {
            font-size: 28px;
            font-weight: bold;
            letter-spacing: 4px;
            color: var(--primary-color);
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            font-family: monospace;
            border: 3px dashed var(--primary-color);
            word-break: break-all;
        }

        .preview-content {
            background: #f9f9f9;
            padding: 30px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.05);
        }

        .document-title {
            text-align: center;
            font-size: 22px;
            color: var(--primary-color);
            margin-bottom: 25px;
            font-weight: bold;
        }

        .info-line {
            display: flex;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            flex-wrap: wrap;
        }

        .info-label {
            width: 200px;
            font-weight: bold;
            color: var(--primary-color);
            font-size: 15px;
        }

        .info-value {
            flex: 1;
            font-size: 15px;
            color: #333;
            min-width: 250px;
        }

        .montant-display {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            margin: 25px 0;
            padding: 20px;
            background: #e8eaf6;
            border-radius: 8px;
            border: 2px solid #c5cae9;
        }

        .signature-area {
            margin-top: 40px;
            text-align: center;
            padding-top: 20px;
            border-top: 2px dashed var(--primary-color);
        }

        .verification-section {
            max-width: 800px;
            margin: 0 auto;
        }

        .search-container {
            background: #e8eaf6;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .code-input-container {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .code-input {
            padding: 15px;
            flex: 1;
            font-size: 18px;
            text-align: center;
            border: 3px solid var(--primary-color);
            border-radius: 8px;
            transition: all 0.3s;
        }

        .code-input:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(26, 35, 126, 0.3);
        }

        .comptabilite-content {
            background: #f5f5f5;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .admin-section {
            margin-bottom: 40px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            border-top: 5px solid var(--primary-color);
        }

        .stat-card h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 18px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--dark-color);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .data-table th {
            background: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        .data-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        .data-table tr:hover {
            background: #f0f0f0;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .status-paid {
            background: #e8f5e9;
            color: var(--success-color);
        }

        .status-pending {
            background: #fff8e1;
            color: #ff8f00;
        }

        .status-unpaid {
            background: #ffebee;
            color: var(--danger-color);
        }

        @media (max-width: 992px) {
            .form-container {
                flex-direction: column;
            }

            .preview-section {
                border-left: none;
                border-top: 2px dashed var(--primary-color);
                padding-left: 0;
                padding-top: 30px;
                margin-top: 30px;
            }

            .nav-container {
                flex-wrap: wrap;
            }

            .nav-btn {
                padding: 15px 20px;
                font-size: 15px;
            }

            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .auth-section {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 576px) {
            .page {
                padding: 20px 15px;
            }

            .form-row {
                flex-direction: column;
                align-items: flex-start;
            }

            .form-label {
                width: 100%;
                margin-bottom: 8px;
            }

            .form-input {
                width: 100%;
            }

            .code-input-container {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .login-container {
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-page" id="loginPage">
        <div class="login-container">
            <div class="logo">
                <img src="R.png" alt="Logo Université">
                <h1>Université Protestante De Lubumbashi</h1>
                <p>Système de Gestion des Paiements</p>
            </div>

            <h2 class="login-title">
                <i class="fas fa-lock"></i> Connexion Comptabilité
            </h2>

            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" placeholder="Entrez votre email" required>
                    <div class="error-message" id="emailError">Veuillez entrer un email valide</div>
                </div>

                <div class="form-group">
                    <label for="loginPassword">Mot de passe</label>
                    <input type="password" id="loginPassword" placeholder="Entrez votre mot de passe" required>
                    <div class="error-message" id="passwordError">Veuillez entrer votre mot de passe</div>
                </div>

                <div class="forgot-password">
                    <a href="#" id="forgotPassword">Mot de passe oublié ?</a>
                </div>

                <button type="submit" class="btn-login">
                    <i class="fas fa-sign-in-alt"></i> Se connecter
                </button>
            </form>
        </div>
    </div>

    <!-- Main Application -->
    <div class="main-app" id="mainApp">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <div class="logo-container">
                    <img src="R.png" alt="Logo Université" id="univLogo">
                    <div class="logo-text">
                        <h1>Université Protestante de Lubumbashi</h1>
                        <p>Système de Gestion des Paiements</p>
                    </div>
                </div>
                <div class="auth-section">
                    <button class="btn btn-secondary" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Déconnexion
                    </button>
                </div>
            </div>

            <!-- Navigation -->
            <div class="nav-container">
                <button class="nav-btn active" id="btnEtudiant">
                    <i class="fas fa-user-graduate"></i> Formulaire Étudiant
                </button>
                <button class="nav-btn" id="btnComptabilite">
                    <i class="fas fa-calculator"></i> Espace Comptabilité
                </button>
                <button class="nav-btn" id="btnAdmin">
                    <i class="fas fa-user-shield"></i> Administration
                </button>
            </div>

            <!-- Page Étudiant -->
            <div class="page active" id="pageEtudiant">
                <div class="form-container">
                    <section class="form-section">
                        <h2 class="section-title">
                            <i class="fas fa-edit"></i> Remplissez le Formulaire
                        </h2>

                        <div class="form-group">
                            <div class="form-row">
                                <label class="form-label required">NOM</label>
                                <input type="text" class="form-input" id="nom" placeholder="Entrez votre nom complet">
                            </div>
                            <div class="error-message" id="nomError">Veuillez entrer votre nom</div>
                        </div>

                        <div class="form-group">
                            <div class="form-row">
                                <label class="form-label required">M-MATRICULE</label>
                                <input type="text" class="form-input" id="matricule" placeholder="Entrez votre matricule">
                            </div>
                            <div class="error-message" id="matriculeError">Veuillez entrer votre matricule</div>
                        </div>

                        <div class="form-group">
                            <div class="form-row">
                                <label class="form-label required">FACULTE</label>
                                <select class="form-input" id="faculte">
                                    <option value="">Sélectionnez votre faculté</option>
                                    <option value="Droit">Droit</option>
                                    <option value="Médecine">theologie</option>
                                    <option value="Sciences">Sciences Informatique</option>
                                    <option value="Lettres">SIC</option>
                                    <option value="Ingénierie">polytechnique</option>
                                    <option value="Economie">Economie</option>
                                </select>
                            </div>
                            <div class="error-message" id="faculteError">Veuillez sélectionner votre faculté</div>
                        </div>

                        <div class="form-group">
                            <div class="form-row">
                                <label class="form-label required">PROMOTION</label>
                                <input type="text" class="form-input" id="promotion" placeholder="Entrez votre promotion">
                            </div>
                            <div class="error-message" id="promotionError">Veuillez entrer votre promotion</div>
                        </div>

                        <div class="form-group">
                            <div class="form-row">
                                <label class="form-label required">TELEPHONE</label>
                                <input type="tel" class="form-input" id="telephone" placeholder="Entrez votre numéro">
                            </div>
                            <div class="error-message" id="telephoneError">Veuillez entrer un numéro valide</div>
                        </div>

                        <div class="form-group">
                            <div class="form-row">
                                <label class="form-label required">TRANCHE À PAYER</label>
                                <div class="tranche-container">
                                    <div class="tranche-grid" id="trancheGrid">
                                        <div class="tranche-item" data-tranche="1" data-montant="220">
                                            <span>Tranche 1</span>
                                            <span>220 USD</span>
                                        </div>
                                        <div class="tranche-item" data-tranche="2" data-montant="270">
                                            <span>Tranche 2</span>
                                            <span>270 USD</span>
                                        </div>
                                        <div class="tranche-item" data-tranche="3" data-montant="220">
                                            <span>Tranche 3</span>
                                            <span>220 USD</span>
                                        </div>
                                        <div class="tranche-item" data-tranche="4" data-montant="260">
                                            <span>Tranche 4</span>
                                            <span>260 USD</span>
</div>

<div class="tranche-item" data-tranche="MINI memoire" data-montant="20">
<span>MINI memoire</span>


<span> 20 USD</span>

</div>

<div class="tranche-item" data-tranche="STAGE" data-montant="20">

<span>STAGE </span>
<span> 20 USD </span>

</div>

<div class="tranche-item" data-tranche="RATTRAPAGE" data-montant="15">

<span> RATTRAPAGE </span>

<span> 15 USD </span>

</div>


                                 
                                    </div>
                                    <div style="margin-top: 15px;">
                                        <div class="form-input" id="total-tranches" style="font-weight: bold; text-align: center;">
                                            Total: 0 USD
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="error-message" id="trancheError">Veuillez sélectionner au moins une tranche</div>
                        </div>

                        <div class="form-group">
                            <div class="form-row">
                                <label class="form-label required">Date de Naissance</label>
                                <input type="date" class="form-input" id="dateNaissance">
                            </div>
                            <div class="error-message" id="dateNaissanceError">Veuillez entrer votre date de naissance</div>
                        </div>

                        <div class="form-group">
                            <div class="form-row">
                                <label class="form-label required">Type Étudiant</label>
                                <select class="form-input" id="typeEtudiant">
                                    <option value="">Sélectionnez votre statut</option>
                                    <option value="Regulier">Régulier</option>
                                    <option value="Boursier">Boursier</option>
                                    <option value="Etranger">Étranger</option>
                                    <option value="Handicape">Étudiant handicapé</option>
                                </select>
                            </div>
                            <div class="error-message" id="typeEtudiantError">Veuillez sélectionner votre statut</div>
                        </div>

                        <div class="form-group">
                            <div class="form-row">
                                <label class="form-label">Moyen de Paiement</label>
                                <select class="form-input" id="moyenPaiement">
                                    <option value="Cash">Cash</option>
                                    
                                    <option value="Carte">Carte Bancaire</option>
                                </select>
                            </div>
                        </div>

                        <div class="btn-container">
                            <button class="btn btn-primary" id="btn-generer">
                                <i class="fas fa-qrcode"></i> Générer le Code
                            </button>
                            <button class="btn btn-secondary" id="btn-reinitialiser">
                                <i class="fas fa-redo"></i> Réinitialiser
                            </button>
                            <button class="btn btn-success" id="btn-payer" style="display: none;">
                                <i class="fas fa-credit-card"></i> Payer en Ligne
                            </button>
                        </div>

                        <div class="code-section">
                            <h3 style="color: var(--primary-color); font-size: 22px; margin-bottom: 15px;">
                                <i class="fas fa-key"></i> Votre Code de Vérification
                            </h3>
                            <div class="code-display" id="codeDisplay">XXXX-XXXX-XXXX</div>
                            <p style="color: #555; font-size: 16px; max-width: 500px; margin: 20px auto 0;">
                                Présentez ce code au service comptable pour valider votre paiement.
                                Vous pouvez aussi <a href="#" id="printLink">imprimer</a> ou <a href="#" id="downloadLink">télécharger</a> votre reçu.
                            </p>
                        </div>
                    </section>

                    <section class="preview-section">
                        <h2 class="section-title">
                            <i class="fas fa-file-alt"></i> Aperçu du Document
                        </h2>
                        <div class="preview-content" id="previewContent">
                            <div class="document-title">2024-2025 MINERVAL POUR ETUDIANTE</div>

                            <div class="info-line">
                                <div class="info-label">NOM</div>
                                <div class="info-value" id="prev-nom">____________________</div>
                            </div>

                            <div class="info-line">
                                <div class="info-label">M-MATRICULE</div>
                                <div class="info-value" id="prev-matricule">____________________</div>
                            </div>

                            <div class="info-line">
                                <div class="info-label">FACULTE</div>
                                <div class="info-value" id="prev-faculte">____________________</div>
                            </div>

                            <div class="info-line">
                                <div class="info-label">PRONCTION</div>
                                <div class="info-value" id="prev-promotion">____________________</div>
                            </div>

                            <div class="info-line">
                                <div class="info-label"> TELEPHONE</div>
                                <div class="info-value" id="prev-telephone">____________________</div>
                            </div>

                            <div class="info-line">
                                <div class="info-label">TRANCHE(S)</div>
                                <div class="info-value" id="prev-tranches">____________________</div>
                            </div>

                            <div class="info-line">
                                <div class="info-label">Date Naissance</div>
                                <div class="info-value" id="prev-dateNaissance">__/__/____</div>
                            </div>

                            <div class="info-line">
                                <div class="info-label">Type Étudiant</div>
                                <div class="info-value" id="prev-typeEtudiant">____________________</div>
                            </div>

                            <div class="montant-display" id="prev-montant">
                                Montant Total: ________ USD
                            </div>

                            <div class="info-line">
                                <div class="info-label">Moyen Paiement</div>
                                <div class="info-value" id="prev-moyenPaiement">____________________</div>
                            </div>

                            <div class="signature-area">
                                <p style="font-weight: bold; margin-bottom: 20px;">Signature:</p>
                                <div style="height: 60px; border-bottom: 1px solid #333; margin-bottom: 10px;"></div>
                                <p style="font-size: 14px; color: #555;">Date: __/__/____</p>
                            </div>
                        </div>
                    </section>
                </div>
            </div>

            <!-- Page Comptabilité -->
            <div class="page" id="pageComptabilite">
                <div class="verification-section">
                    <div class="search-container">
                        <h2 class="section-title">
                            <i class="fas fa-search"></i> Vérification des Paiements
                        </h2>
                        <p style="color: #555; margin-bottom: 20px;">
                            Entrez le code fourni par l'étudiant ou recherchez par matricule pour valider le paiement.
                        </p>

                        <div class="code-input-container">
                            <input type="text" class="code-input" id="verificationCode" placeholder="Entrez le code de vérification">
                            <button class="btn btn-primary" id="btn-verifier">
                                <i class="fas fa-check"></i> Vérifier
                            </button>
                        </div>

                        <div style="text-align: center; margin-top: 15px; color: #777;">
                            OU
                        </div>

                        <div class="form-row" style="margin-top: 15px;">
                            <input type="text" class="form-input" id="searchMatricule" placeholder="Rechercher par matricule">
                            <button class="btn btn-secondary" id="btn-searchMatricule" style="margin-top: 10px;">
                                <i class="fas fa-search"></i> Rechercher
                            </button>
                        </div>
                    </div>

                    <div class="comptabilite-content" id="comptabiliteContent">
                        <p style="text-align: center; padding: 40px 20px; font-size: 18px; color: #777;">
                            Les informations de l'étudiant s'afficheront ici après vérification du code.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Page Admin -->
            <div class="page" id="pageAdmin">
                <div class="admin-section">
                    <h2 class="section-title">
                        <i class="fas fa-tachometer-alt"></i> Tableau de Bord
                    </h2>

                    <div class="stats-container">
                        <div class="stat-card">
                            <h3><i class="fas fa-users"></i> Étudiants Enregistrés</h3>
                            <div class="stat-value" id="statEtudiants">0</div>
                        </div>
                        <div class="stat-card">
                            <h3><i class="fas fa-money-bill-wave"></i> Paiements Validés</h3>
                            <div class="stat-value" id="statPaiements">0</div>
                        </div>
                        <div class="stat-card">
                            <h3><i class="fas fa-clock"></i> Paiements En Attente</h3>
                            <div class="stat-value" id="statEnAttente">0</div>
                        </div>
                        <div class="stat-card">
                            <h3><i class="fas fa-coins"></i> Recettes Totales</h3>
                            <div class="stat-value" id="statRecettes">0 USD</div>
                        </div>
                        <div class="stat-card">
                            <h3><i class="fas fa-calendar-day"></i> Recettes Aujourd'hui</h3>
                            <div class="stat-value" id="statRecettesAujourdhui">0 USD</div>
                        </div>
                    </div>

                    <h3 class="section-title" style="margin-top: 40px;">
                        <i class="fas fa-list"></i> Derniers Paiements
                    </h3>

                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Matricule</th>
                                    <th>Nom</th>
                                    <th>Faculté</th>
                                    <th>Tranches</th>
                                    <th>Montant</th>
                                    <th>Date</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="paiementsTable">
                                <!-- Rows will be added by JavaScript -->
                            </tbody>
                        </table>
                    </div>

                    <div class="btn-container" style="margin-top: 30px;">
                        <button class="btn btn-primary" id="btnExportExcel">
                            <i class="fas fa-file-excel"></i> Exporter en Excel
                        </button>
                        <button class="btn btn-secondary" id="btnExportPDF">
                            <i class="fas fa-file-pdf"></i> Exporter en PDF
                        </button>
                        <button class="btn btn-success" id="btnDailyReport">
                            <i class="fas fa-calendar-day"></i> Rapport Journalier
                        </button>
                    </div>
                </div>

                <div class="admin-section" style="margin-top: 50px;">
                    <h2 class="section-title">
                        <i class="fas fa-cog"></i> Paramètres
                    </h2>

                    <div class="form-row">
                        <label class="form-label">Montants par Faculté</label>
                        <div style="flex: 1;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Faculté</th>
                                        <th>Montant Standard (USD)</th>
                                        <th>Montant Boursier (USD)</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="montantsFaculteTable">
                                    <tr>
                                        <td>Droit</td>
                                        <td><input type="number" class="form-input" value="250.0"></td>
                                        <td><input type="number" class="form-input" value="125.0"></td>
                                        <td><button class="btn btn-secondary">Enregistrer</button></td>
                                    </tr>
                                    <tr>
                                        <td>Médecine</td>
                                        <td><input type="number" class="form-input" value="300.0"></td>
                                        <td><input type="number" class="form-input" value="150.0"></td>
                                        <td><button class="btn btn-secondary">Enregistrer</button></td>
                                    </tr>
                                    <tr>
                                        <td>Sciences Informatiques</td>
                                        <td><input type="number" class="form-input" value="275.0"></td>
                                        <td><input type="number" class="form-input" value="137.5"></td>
                                        <td><button class="btn btn-secondary">Enregistrer</button></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="form-row" style="margin-top: 30px;">
                        <label class="form-label">Logo de l'Université</label>
                        <div style="flex: 1; display: flex; align-items: center; gap: 20px;">
                            <img src="R.png" alt="Logo" id="currentLogo" style="border: 1px solid #ddd; border-radius: 5px; width: 50px;">
                            <input type="file" id="logoUpload" accept="image/*" style="display: none;">
                            <button class="btn btn-secondary" id="btnUploadLogo">
                                <i class="fas fa-upload"></i> Changer le Logo
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize jsPDF
        const { jsPDF } = window.jspdf;

        document.addEventListener('DOMContentLoaded', function() {
            // Credentials prédéfinis
            const COMPTABLE_EMAIL = 'theombowa2@gmail.com';
            const COMPTABLE_PASSWORD = 'Mpiana33';

            // Check if user is already logged in
            const isLoggedIn = localStorage.getItem('minerval_loggedIn') === 'true';

            if (isLoggedIn) {
                showMainApp();
            }

            // Login Form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();

                const email = document.getElementById('loginEmail').value.trim();
                const password = document.getElementById('loginPassword').value.trim();

                // Reset errors
                document.getElementById('emailError').style.display = 'none';
                document.getElementById('passwordError').style.display = 'none';

                let isValid = true;

                // Validate email
                if (email !== COMPTABLE_EMAIL) {
                    document.getElementById('emailError').textContent = 'Email incorrect';
                    document.getElementById('emailError').style.display = 'block';
                    isValid = false;
                }

                // Validate password
                if (password !== COMPTABLE_PASSWORD) {
                    document.getElementById('passwordError').textContent = 'Mot de passe incorrect';
                    document.getElementById('passwordError').style.display = 'block';
                    isValid = false;
                }

                if (isValid) {
                    // Successful login
                    localStorage.setItem('minerval_loggedIn', 'true');
                    showMainApp();
                } else {
                    // Shake animation for error
                    this.style.animation = 'shake 0.5s';
                    setTimeout(() => {
                        this.style.animation = '';
                    }, 500);
                }
            });

            // Forgot password
            document.getElementById('forgotPassword').addEventListener('click', function(e) {
                e.preventDefault();
                const email = prompt('Veuillez entrer votre email pour réinitialiser le mot de passe:');

                if (email && email === COMPTABLE_EMAIL) {
                    alert('Un email de réinitialisation a été envoyé à ' + COMPTABLE_EMAIL);
                } else if (email) {
                    alert('Email non reconnu');
                }
            });

            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', function() {
                localStorage.removeItem('minerval_loggedIn');
                location.reload();
            });

            // Show main application
            function showMainApp() {
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                initializeMainApp();
            }

            // Initialize main application
            function initializeMainApp() {
                // Navigation between pages
                document.getElementById('btnEtudiant').addEventListener('click', function() {
                    switchPage('pageEtudiant', this);
                });

                document.getElementById('btnComptabilite').addEventListener('click', function() {
                    switchPage('pageComptabilite', this);
                });

                document.getElementById('btnAdmin').addEventListener('click', function() {
                    switchPage('pageAdmin', this);
                    loadAdminData();
                });

                function switchPage(pageId, button) {
                    document.querySelectorAll('.page').forEach(page => {
                        page.classList.remove('active');
                    });
                    document.querySelectorAll('.nav-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });

                    document.getElementById(pageId).classList.add('active');
                    button.classList.add('active');
                }

                // Gestion des tranches
                document.querySelectorAll('.tranche-item').forEach(item => {
                    item.addEventListener('click', function() {
                        this.classList.toggle('selected');
                        calculateTotalTranches();
                        updatePreview();
                    });
                });

                function calculateTotalTranches() {
                    const selectedTranches = document.querySelectorAll('.tranche-item.selected');
                    let total = 0;
                    
                    selectedTranches.forEach(tranche => {
                        total += parseFloat(tranche.dataset.montant);
                    });
                    
                    document.getElementById('total-tranches').textContent = `Total: ${total.toFixed(2)} USD`;
                    return total;
                }

                // Update preview when fields change
                document.querySelectorAll('#nom, #matricule, #promotion, #telephone').forEach(el => {
                    el.addEventListener('input', updatePreview);
                });

                document.getElementById('faculte').addEventListener('change', updatePreview);
                document.getElementById('dateNaissance').addEventListener('change', updatePreview);
                document.getElementById('typeEtudiant').addEventListener('change', updatePreview);
                document.getElementById('moyenPaiement').addEventListener('change', updatePreview);

                // Generate Code Button
                document.getElementById('btn-generer').addEventListener('click', function() {
                    genererCode();
                });

                // Reset Button
                document.getElementById('btn-reinitialiser').addEventListener('click', function() {
                    resetForm();
                });

                // Verify Button
                document.getElementById('btn-verifier').addEventListener('click', function() {
                    verifierCode();
                });

                // Search by Matricule Button
                document.getElementById('btn-searchMatricule').addEventListener('click', function() {
                    searchByMatricule();
                });

                // Print Link
                document.getElementById('printLink').addEventListener('click', function(e) {
                    e.preventDefault();
                    printDocument();
                });

                // Download Link
                document.getElementById('downloadLink').addEventListener('click', function(e) {
                    e.preventDefault();
                    generatePDF();
                });

                // Pay Online Button
                document.getElementById('btn-payer').addEventListener('click', function() {
                    processPayment();
                });

                // Export Excel Button
                document.getElementById('btnExportExcel').addEventListener('click', function() {
                    exportToExcel();
                });

                // Export PDF Button
                document.getElementById('btnExportPDF').addEventListener('click', function() {
                    exportToPDF();
                });

                // Daily Report Button
                document.getElementById('btnDailyReport').addEventListener('click', function() {
                    generateDailyReport();
                });

                // Upload Logo Button
                document.getElementById('btnUploadLogo').addEventListener('click', function() {
                    document.getElementById('logoUpload').click();
                });

                document.getElementById('logoUpload').addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            document.getElementById('currentLogo').src = event.target.result;
                            document.getElementById('univLogo').src = event.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                });

                // Update preview function
                function updatePreview() {
                    // Validate required fields
                    const requiredFields = ['nom', 'matricule', 'faculte', 'promotion', 'telephone', 'dateNaissance', 'typeEtudiant'];
                    let isValid = true;

                    requiredFields.forEach(field => {
                        const value = document.getElementById(field).value;
                        const errorElement = document.getElementById(field + 'Error');

                        if (!value) {
                            errorElement.style.display = 'block';
                            document.getElementById(field).classList.add('error');
                            isValid = false;
                        } else {
                            errorElement.style.display = 'none';
                            document.getElementById(field).classList.remove('error');
                        }
                    });

                    // Check tranches
                    const selectedTranches = document.querySelectorAll('.tranche-item.selected');
                    if (selectedTranches.length === 0) {
                        document.getElementById('trancheError').style.display = 'block';
                        isValid = false;
                    } else {
                        document.getElementById('trancheError').style.display = 'none';
                    }

                    // Update preview fields
                    document.getElementById('prev-nom').textContent = document.getElementById('nom').value || '____________________';
                    document.getElementById('prev-matricule').textContent = document.getElementById('matricule').value || '____________________';
                    document.getElementById('prev-faculte').textContent = document.getElementById('faculte').value || '____________________';
                    document.getElementById('prev-promotion').textContent = document.getElementById('promotion').value || '____________________';
                    document.getElementById('prev-telephone').textContent = document.getElementById('telephone').value || '____________________';

                    // Update tranches preview
                    const tranchesList = Array.from(selectedTranches).map(t => `Tranche ${t.dataset.tranche}`).join(', ');
                    document.getElementById('prev-tranches').textContent = selectedTranches.length > 0 ? tranchesList : '____________________';

                    const dateNaissance = document.getElementById('dateNaissance').value;
                    if (dateNaissance) {
                        const date = new Date(dateNaissance);
                        document.getElementById('prev-dateNaissance').textContent = date.toLocaleDateString('fr-FR');
                    } else {
                        document.getElementById('prev-dateNaissance').textContent = '__/__/____';
                    }

                    document.getElementById('prev-typeEtudiant').textContent = document.getElementById('typeEtudiant').value || '____________________';
                    document.getElementById('prev-moyenPaiement').textContent = document.getElementById('moyenPaiement').value || '____________________';

                    // Update montant total
                    const total = calculateTotalTranches();
                    document.getElementById('prev-montant').textContent = `Montant Total: ${total > 0 ? total.toFixed(2) + ' USD' : '________ USD'}`;

                    // Show/hide pay online button
                    if (isValid && selectedTranches.length > 0) {
                        document.getElementById('btn-payer').style.display = 'flex';
                    } else {
                        document.getElementById('btn-payer').style.display = 'none';
                    }
                }

                // Generate unique code
                function genererCode() {
                    // Validate form
                    updatePreview();
                    if (document.querySelectorAll('.error-message[style="display: block;"]').length > 0) {
                        alert('Veuillez corriger les erreurs dans le formulaire');
                        return;
                    }

                    const selectedTranches = Array.from(document.querySelectorAll('.tranche-item.selected'))
                                        .map(t => t.dataset.tranche);

                    if (selectedTranches.length === 0) {
                        document.getElementById('trancheError').style.display = 'block';
                        return;
                    }

                    // Generate random code
                    const chars = '123456789ABC';
                    let code = '';

                    for (let i = 0; i < 12; i++) {
                        if (i > 0 && i % 4 === 0) code += '-';
                        code += chars.charAt(Math.floor(Math.random() * chars.length));
                    }

                    document.getElementById('codeDisplay').textContent = code;

                    // Store data in localStorage
                    const data = {
                        nom: document.getElementById('nom').value,
                        matricule: document.getElementById('matricule').value,
                        faculte: document.getElementById('faculte').value,
                        promotion: document.getElementById('promotion').value,
                        telephone: document.getElementById('telephone').value,
                        dateNaissance: document.getElementById('dateNaissance').value,
                        typeEtudiant: document.getElementById('typeEtudiant').value,
                        tranches: selectedTranches,
                        montantTotal: calculateTotalTranches(),
                        moyenPaiement: document.getElementById('moyenPaiement').value,
                        date: new Date().toLocaleDateString('fr-FR'),
                        timestamp: new Date().getTime(),
                        status: 'pending'
                    };

                    // Save to localStorage
                    localStorage.setItem('minerval_' + code, JSON.stringify(data));

                    alert('Code généré avec succès! Veuillez le fournir à la comptabilité.');
                }

                // Reset form
                function resetForm() {
                    document.getElementById('nom').value = '';
                    document.getElementById('matricule').value = '';
                    document.getElementById('faculte').value = '';
                    document.getElementById('promotion').value = '';
                    document.getElementById('telephone').value = '';
                    document.getElementById('dateNaissance').value = '';
                    document.getElementById('typeEtudiant').value = '';
                    document.getElementById('moyenPaiement').value = 'Cash';

                    document.querySelectorAll('.tranche-item').forEach(el => {
                        el.classList.remove('selected');
                    });

                    document.querySelectorAll('.error-message').forEach(el => {
                        el.style.display = 'none';
                    });

                    document.querySelectorAll('.form-input').forEach(el => {
                        el.classList.remove('error');
                    });

                    updatePreview();
                    document.getElementById('codeDisplay').textContent = 'XXXX-XXXX-XXXX';
                    document.getElementById('btn-payer').style.display = 'none';
                    document.getElementById('total-tranches').textContent = 'Total: 0 USD';
                }

                // Verify code
                function verifierCode() {
                    const code = document.getElementById('verificationCode').value.trim();

                    if (!code) {
                        alert('Veuillez entrer un code de vérification');
                        return;
                    }

                    const data = localStorage.getItem('minerval_' + code);

                    if (!data) {
                        alert('Code invalide ou expiré');
                        return;
                    }

                    const info = JSON.parse(data);

                    // Check if code expired (30 days)
                    const now = new Date().getTime();
                    const thirtyDays = 30 * 24 * 60 * 60 * 1000;

                    if (now - info.timestamp > thirtyDays) {
                        alert('Ce code a expiré (valable 30 jours)');
                        return;
                    }

                    // Display student information
                    displayStudentInfo(code, info);
                }

                // Search by matricule
                function searchByMatricule() {
                    const matricule = document.getElementById('searchMatricule').value.trim();

                    if (!matricule) {
                        alert('Veuillez entrer un matricule');
                        return;
                    }

                    // Search in localStorage
                    let foundCode = null;
                    let foundData = null;

                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key.startsWith('minerval_')) {
                            const data = JSON.parse(localStorage.getItem(key));
                            if (data.matricule === matricule) {
                                foundCode = key.replace('minerval_', '');
                                foundData = data;
                                break;
                            }
                        }
                    }

                    if (!foundCode) {
                        alert('Aucun paiement trouvé pour ce matricule');
                        return;
                    }

                    // Display student information
                    displayStudentInfo(foundCode, foundData);
                    document.getElementById('verificationCode').value = foundCode;
                }

                // Display student information
                function displayStudentInfo(code, data) {
                    const content = `
                        <div class="document-title">2024-2025 MINERVAL POUR ETUDIANTE</div>

                        <div class="info-line">
                            <div class="info-label">NOM</div>
                            <div class="info-value">${data.nom}</div>
                        </div>

                        <div class="info-line">
                            <div class="info-label">M-MATRICULE</div>
                            <div class="info-value">${data.matricule}</div>
                        </div>

                        <div class="info-line">
                            <div class="info-label">FACULTE</div>
                            <div class="info-value">${data.faculte}</div>
                        </div>

                        <div class="info-line">
                            <div class="info-label">PRONCTION</div>
                            <div class="info-value">${data.promotion}</div>
                        </div>

                        <div class="info-line">
                            <div class="info-label">EN TELEPHONE</div>
                            <div class="info-value">${data.telephone}</div>
                        </div>

                        <div class="info-line">
                            <div class="info-label">TRANCHE(S)</div>
                            <div class="info-value">${data.tranches ? data.tranches.map(t => 'Tranche ' + t).join(', ') : 'N/A'}</div>
                        </div>

                        <div class="info-line">
                            <div class="info-label">Date Naissance</div>
                            <div class="info-value">${data.dateNaissance ? new Date(data.dateNaissance).toLocaleDateString('fr-FR') : 'N/A'}</div>
                        </div>

                        <div class="info-line">
                            <div class="info-label">Type Étudiant</div>
                            <div class="info-value">${data.typeEtudiant}</div>
                        </div>

                        <div class="montant-display">
                            Montant Total: ${data.montantTotal || data.montant} USD
                        </div>

                        <div class="info-line">
                            <div class="info-label">Moyen Paiement</div>
                            <div class="info-value">${data.moyenPaiement}</div>
                        </div>

                        <div class="info-line">
                            <div class="info-label">Date Soumission</div>
                            <div class="info-value">${data.date}</div>
                        </div>

                        <div class="info-line">
                            <div class="info-label">Code Vérification</div>
                            <div class="info-value">${code}</div>
                        </div>

                        <div class="info-line">
                            <div class="info-label">Statut Paiement</div>
                            <div class="info-value">
                                <span class="status-badge ${data.status === 'paid' ? 'status-paid' : data.status === 'pending' ? 'status-pending' : 'status-unpaid'}">
                                    ${data.status === 'paid' ? 'Payé' : data.status === 'pending' ? 'En Attente' : 'Non Payé'}
                                </span>
                            </div>
                        </div>

                        <div class="signature-area">
                            <p style="font-weight: bold; margin-bottom: 20px;">Signature de l'agent comptable:</p>
                            <div style="height: 60px; border-bottom: 1px solid #333; margin-bottom: 10px;"></div>
                            <p style="font-size: 14px; color: #555;">Date: ${new Date().toLocaleDateString('fr-FR')}</p>
                        </div>

                        <div class="btn-container" style="margin-top: 30px;">
                            <button class="btn btn-success" id="btnValiderPaiement" ${data.status === 'paid' ? 'disabled' : ''}>
                                <i class="fas fa-check-circle"></i> Valider le Paiement
                            </button>
                            <button class="btn btn-danger" id="btnRejeterPaiement" ${data.status === 'unpaid' ? 'disabled' : ''}>
                                <i class="fas fa-times-circle"></i> Rejeter le Paiement
                            </button>
                        </div>
                    `;

                    document.getElementById('comptabiliteContent').innerHTML = content;

                    // Add event listeners to action buttons
                    if (document.getElementById('btnValiderPaiement')) {
                        document.getElementById('btnValiderPaiement').addEventListener('click', function() {
                            validatePayment(code);
                        });
                    }

                    if (document.getElementById('btnRejeterPaiement')) {
                        document.getElementById('btnRejeterPaiement').addEventListener('click', function() {
                            rejectPayment(code);
                        });
                    }
                }

                // Validate payment
                function validatePayment(code) {
                    if (!confirm('Confirmer la validation de ce paiement ?')) return;

                    const data = JSON.parse(localStorage.getItem('minerval_' + code));
                    data.status = 'paid';
                    localStorage.setItem('minerval_' + code, JSON.stringify(data));

                    alert('Paiement validé avec succès !');
                    verifierCode(); // Refresh the display
                    loadAdminData(); // Update admin stats
                }

                // Reject payment
                function rejectPayment(code) {
                    if (!confirm('Confirmer le rejet de ce paiement ?')) return;

                    const data = JSON.parse(localStorage.getItem('minerval_' + code));
                    data.status = 'unpaid';
                    localStorage.setItem('minerval_' + code, JSON.stringify(data));

                    alert('Paiement rejeté !');
                    verifierCode(); // Refresh the display
                    loadAdminData(); // Update admin stats
                }

                // Process online payment
                function processPayment() {
                    alert('Fonctionnalité de paiement en ligne sera implémentée ici');
                    // Integration with payment gateway would go here
                }

                // Print document
                function printDocument() {
                    const code = document.getElementById('codeDisplay').textContent;
                    if (code === 'XXXX-XXXX-XXXX') {
                        alert('Veuillez d\'abord générer un code');
                        return;
                    }

                    const printContent = document.getElementById('previewContent').innerHTML;
                    const originalContent = document.body.innerHTML;

                    document.body.innerHTML = `
                        <div style="padding: 20px; max-width: 800px; margin: 0 auto;">
                            ${printContent}
                            <div style="text-align: center; margin-top: 30px; font-size: 12px;">
                                Code de vérification: ${code}
                            </div>
                        </div>
                    `;

                    window.print();
                    document.body.innerHTML = originalContent;
                    window.location.reload();
                }

                // Generate PDF
                function generatePDF() {
                    const code = document.getElementById('codeDisplay').textContent;
                    if (code === 'XXXX-XXXX-XXXX') {
                        alert('Veuillez d\'abord générer un code');
                        return;
                    }

                    const doc = new jsPDF();

                    // Add logo
                    doc.addImage(document.getElementById('univLogo').src, 'JPEG', 15, 10, 30, 30);

                    // Title
                    doc.setFontSize(18);
                    doc.setTextColor(26, 35, 126);
                    doc.text('2024-2025 MINERVAL POUR ETUDIANTE', 105, 20, { align: 'center' });

                    // Student info
                    doc.setFontSize(12);
                    doc.setTextColor(0, 0, 0);

                    const infoLines = [
                        { label: 'NOM', value: document.getElementById('nom').value || '____________________' },
                        { label: 'M-MATRICULE', value: document.getElementById('matricule').value || '____________________' },
                        { label: 'FACULTE', value: document.getElementById('faculte').value || '____________________' },
                        { label: 'PRONCTION', value: document.getElementById('promotion').value || '____________________' },
                        { label: 'EN TELEPHONE', value: document.getElementById('telephone').value || '____________________' },
                        { label: 'TRANCHE(S)', value: Array.from(document.querySelectorAll('.tranche-item.selected')).map(t => `Tranche ${t.dataset.tranche}`).join(', ') || '____________________' },
                        { label: 'Date Naissance', value: document.getElementById('dateNaissance').value ? new Date(document.getElementById('dateNaissance').value).toLocaleDateString('fr-FR') : '__/__/____' },
                        { label: 'Type Étudiant', value: document.getElementById('typeEtudiant').value || '____________________' }
                    ];

                    let y = 40;
                    infoLines.forEach(line => {
                        doc.text(line.label + ': ', 20, y);
                        doc.text(line.value, 70, y);
                        y += 8;
                    });

                    // Amount
                    doc.setFontSize(14);
                    doc.setTextColor(26, 35, 126);
                    const total = calculateTotalTranches();
                    doc.text('Montant Total: ' + (total > 0 ? total.toFixed(2) + ' USD' : '________ USD'), 105, y + 10, { align: 'center' });

                    // Payment method
                    doc.setFontSize(12);
                    doc.setTextColor(0, 0, 0);
                    doc.text('Moyen de Paiement: ' + (document.getElementById('moyenPaiement').value || '____________________'), 20, y + 25);

                    // Signature
                    doc.line(20, y + 45, 80, y + 45);
                    doc.text('Signature', 20, y + 50);

                    doc.line(120, y + 45, 180, y + 45);
                    doc.text('Agent Comptable', 120, y + 50);

                    // Date
                    doc.text('Date: ' + new Date().toLocaleDateString('fr-FR'), 20, y + 65);

                    // Verification code
                    doc.setFontSize(10);
                    doc.setTextColor(100, 100, 100);
                    doc.text('Code de vérification: ' + code, 20, 280);

                    // Save PDF
                    doc.save('minerval_' + document.getElementById('matricule').value + '.pdf');
                }

                // Export to Excel
                function exportToExcel() {
                    // This would normally use a library like SheetJS
                    alert('Fonctionnalité d\'export Excel sera implémentée ici');
                }

                // Export to PDF
                function exportToPDF() {
                    const doc = new jsPDF();

                    // Add title
                    doc.setFontSize(18);
                    doc.setTextColor(26, 35, 126);
                    doc.text('Rapport des Paiements de Minerval', 105, 20, { align: 'center' });

                    // Add date
                    doc.setFontSize(12);
                    doc.setTextColor(0, 0, 0);
                    doc.text('Généré le: ' + new Date().toLocaleDateString('fr-FR'), 15, 30);

                    // Add stats
                    doc.text(`Total Étudiants: ${document.getElementById('statEtudiants').textContent}`, 15, 40);
                    doc.text(`Paiements Validés: ${document.getElementById('statPaiements').textContent}`, 15, 48);
                    doc.text(`Paiements En Attente: ${document.getElementById('statEnAttente').textContent}`, 15, 56);
                    doc.text(`Recettes Totales: ${document.getElementById('statRecettes').textContent}`, 15, 64);
                    doc.text(`Recettes Aujourd'hui: ${document.getElementById('statRecettesAujourdhui').textContent}`, 15, 72);

                    // Get all payments from localStorage
                    const paiements = [];
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key.startsWith('minerval_')) {
                            const data = JSON.parse(localStorage.getItem(key));
                            data.code = key.replace('minerval_', '');
                            paiements.push(data);
                        }
                    }

                    // Sort by date (newest first)
                    paiements.sort((a, b) => b.timestamp - a.timestamp);

                    // Prepare table data
                    const tableData = paiements.map(paiement => [
                        paiement.matricule,
                        paiement.nom,
                        paiement.faculte,
                        paiement.tranches ? paiement.tranches.map(t => 'T' + t).join(', ') : 'N/A',
                        (paiement.montantTotal || paiement.montant) + ' USD',
                        paiement.date,
                        paiement.status === 'paid' ? 'Payé' : paiement.status === 'pending' ? 'En Attente' : 'Non Payé'
                    ]);

                    // Add table
                    doc.autoTable({
                        startY: 80,
                        head: [['Matricule', 'Nom', 'Faculté', 'Tranches', 'Montant', 'Date', 'Statut']],
                        body: tableData,
                        styles: { fontSize: 9 },
                        headStyles: { fillColor: [26, 35, 126] }
                    });

                    // Save PDF
                    doc.save('rapport_paiements_minerval.pdf');
                }

                // Generate daily report
                function generateDailyReport() {
                    const today = new Date().toLocaleDateString('fr-FR');
                    const paiements = [];
                    let totalAmount = 0;
                    let paidCount = 0;
                    let pendingCount = 0;
                    
                    // Parcourir tous les paiements
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key.startsWith('minerval_')) {
                            const paiement = JSON.parse(localStorage.getItem(key));
                            if (paiement.date === today) {
                                paiements.push(paiement);
                                if (paiement.status === 'paid') {
                                    paidCount++;
                                    totalAmount += parseFloat(paiement.montantTotal || paiement.montant);
                                } else if (paiement.status === 'pending') {
                                    pendingCount++;
                                }
                            }
                        }
                    }
                    
                    // Générer le PDF
                    const doc = new jsPDF();
                    
                    // En-tête
                    doc.setFontSize(18);
                    doc.setTextColor(26, 35, 126);
                    doc.text('Rapport Journalier des Paiements', 105, 20, { align: 'center' });
                    doc.setFontSize(14);
                    doc.text(today, 105, 30, { align: 'center' });
                    
                    // Statistiques
                    doc.setFontSize(12);
                    doc.setTextColor(0, 0, 0);
                    doc.text(`Nombre total d'étudiants: ${paiements.length}`, 20, 50);
                    doc.text(`Paiements validés: ${paidCount}`, 20, 60);
                    doc.text(`Paiements en attente: ${pendingCount}`, 20, 70);
                    doc.text(`Montant total collecté: ${totalAmount.toFixed(2)} USD`, 20, 80);
                    
                    // Détails des transactions
                    doc.text('Détails des transactions:', 20, 100);
                    
                    const tableData = paiements.map(p => [
                        p.matricule,
                        p.nom,
                        p.tranches ? p.tranches.map(t => 'T' + t).join(', ') : 'N/A',
                        (p.montantTotal || p.montant) + ' USD',
                        p.status === 'paid' ? 'Payé' : 'En attente'
                    ]);
                    
                    doc.autoTable({
                        startY: 110,
                        head: [['Matricule', 'Nom', 'Tranches', 'Montant', 'Statut']],
                        body: tableData,
                        styles: { fontSize: 9 },
                        headStyles: { fillColor: [26, 35, 126] }
                    });
                    
                    doc.save(`rapport_journalier_${today.replace(/\//g, '-')}.pdf`);
                }

                // Load admin data
                function loadAdminData() {
                    const today = new Date().toLocaleDateString('fr-FR');
                    const paiements = [];
                    let totalPaid = 0;
                    let totalPending = 0;
                    let totalAmount = 0;
                    let todayAmount = 0;

                    // Get all payments from localStorage
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key.startsWith('minerval_')) {
                            const paiement = JSON.parse(localStorage.getItem(key));
                            paiement.code = key.replace('minerval_', '');
                            paiements.push(paiement);

                            if (paiement.status === 'paid') {
                                totalPaid++;
                                totalAmount += parseFloat(paiement.montantTotal || paiement.montant);
                                
                                if (paiement.date === today) {
                                    todayAmount += parseFloat(paiement.montantTotal || paiement.montant);
                                }
                            } else if (paiement.status === 'pending') {
                                totalPending++;
                            }
                        }
                    }

                    // Update stats
                    document.getElementById('statEtudiants').textContent = paiements.length;
                    document.getElementById('statPaiements').textContent = totalPaid;
                    document.getElementById('statEnAttente').textContent = totalPending;
                    document.getElementById('statRecettes').textContent = totalAmount.toFixed(2) + ' USD';
                    document.getElementById('statRecettesAujourdhui').textContent = todayAmount.toFixed(2) + ' USD';

                    // Update payments table
                    const tableBody = document.getElementById('paiementsTable');
                    tableBody.innerHTML = '';

                    // Sort by date (newest first)
                    paiements.sort((a, b) => b.timestamp - a.timestamp);

                    // Show only last 10
                    paiements.slice(0, 10).forEach(paiement => {
                        const row = document.createElement('tr');

                        row.innerHTML = `
                            <td>${paiement.matricule}</td>
                            <td>${paiement.nom}</td>
                            <td>${paiement.faculte}</td>
                            <td>${paiement.tranches ? paiement.tranches.map(t => 'T' + t).join(', ') : 'N/A'}</td>
                            <td>${paiement.montantTotal || paiement.montant} USD</td>
                            <td>${paiement.date}</td>
                            <td>
                                <span class="status-badge ${paiement.status === 'paid' ? 'status-paid' : paiement.status === 'pending' ? 'status-pending' : 'status-unpaid'}">
                                    ${paiement.status === 'paid' ? 'Payé' : paiement.status === 'pending' ? 'En Attente' : 'Non Payé'}
                                </span>
                            </td>
                            <td>
                                <button class="btn btn-secondary btn-sm view-payment" data-code="${paiement.code}">
                                    <i class="fas fa-eye"></i> Voir
                                </button>
                            </td>
                        `;

                        tableBody.appendChild(row);
                    });

                    // Add event listeners to view buttons
                    document.querySelectorAll('.view-payment').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const code = this.getAttribute('data-code');
                            document.getElementById('verificationCode').value = code;
                            document.getElementById('btnComptabilite').click();
                            verifierCode();
                        });
                    });
                }

                // Initialize preview
                updatePreview();

                // Load admin data if on admin page
                if (document.getElementById('pageAdmin').classList.contains('active')) {
                    loadAdminData();
                }
            }

            // Add shake animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes shake {
                    0%, 100% { transform: translateX(0); }
                    10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                    20%, 40%, 60%, 80% { transform: translateX(5px); }
                }
            `;
            document.head.appendChild(style);
        });
    </script>
</body>
</html>